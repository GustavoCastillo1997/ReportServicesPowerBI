{"visual":{"name":"Gerar Relatório","displayName":"Gerar Relatório","guid":"qe5k6fz8g7ydw","visualClassName":"Visual","version":"1.0.0.0","description":"Botão que envia dataviews para API e gera relatório excel","supportUrl":"https://github.com/GustavoCastillo1997","gitHubUrl":"https://github.com/GustavoCastillo1997"},"author":{"name":"Gustavo Olmedo Scevola Castillo","email":"gustavoosc_@hotmail.com"},"apiVersion":"5.3.0","style":"style/visual.less","stringResources":{},"capabilities":{"dataRoles":[{"name":"dados","kind":"Grouping","displayName":"Filtros"}],"dataViewMappings":[{"table":{"rows":{"select":[{"for":{"in":"dados"}}]}}}],"objects":{},"privileges":[]},"content":{"js":"var qe5k6fz8g7ydw;(()=>{\"use strict\";var e={67:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(a,r){function i(e){try{s(o.next(e))}catch(e){r(e)}}function l(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,l)}s((o=o.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,o,a,r,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},\"function\"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(l){return function(s){return function(l){if(n)throw new TypeError(\"Generator is already executing.\");for(;r&&(r=0,l[0]&&(i=0)),i;)try{if(n=1,o&&(a=2&l[0]?o.return:l[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,l[1])).done)return a;switch(o=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,o=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){i.label=l[1];break}if(6===l[0]&&i.label<a[1]){i.label=a[1],a=l;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(l);break}a[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],o=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}};Object.defineProperty(t,\"__esModule\",{value:!0}),t.handleError=t.processBackendResult=t.handleResponse=void 0;var r=n(995);function i(e,t){(null==e?void 0:e.sasUrl)?((0,r.log)(t,\"Abrindo relatório...\"),window.open(e.sasUrl,\"_blank\")):(0,r.log)(t,\"Resposta recebida, mas 'sasUrl' não encontrado.\")}t.handleResponse=function(e){var t=this;return function(n){return o(t,void 0,void 0,function(){var t;return a(this,function(o){switch(o.label){case 0:return n.ok?[4,n.json()]:((0,r.log)(e,\"Erro ao enviar: \".concat(n.status)),alert(\"Erro ao enviar: \".concat(n.status)),[2]);case 1:return t=o.sent(),(0,r.log)(e,\"Requisição enviada com sucesso.\"),alert(\"Requisição enviada com sucesso.\"),i(t,e),[2]}})})}},t.processBackendResult=i,t.handleError=function(e,t){(0,r.log)(t,\"Falha na requisição: \".concat(e.message)),alert(\"Falha na requisição: \"+e.message)}},369:(e,t,n)=>{Object.defineProperty(t,\"__esModule\",{value:!0}),t.sendRequest=void 0;var o=n(995),a=n(67);t.sendRequest=function(e,t){(0,o.log)(t,\"Enviando requisição...\"),fetch(\"https://apcbrh-powerbi-report-app.azurewebsites.net/api/bi_castrolanda_single\",function(e){return{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({filtros:e})}}(e)).then((0,a.handleResponse)(t)).catch(function(e){return(0,a.handleError)(e,t)})}},669:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:!0}),t.extractTableData=void 0,t.extractTableData=function(e){var t=null==e?void 0:e.table;if(!t||!t.rows||!t.columns)return[];var n=t.columns.map(function(e){return e.displayName});return t.rows.map(function(e){var t={};return e.forEach(function(e,o){t[n[o]]=e}),t})}},764:(e,t,n)=>{Object.defineProperty(t,\"__esModule\",{value:!0}),t.Visual=void 0;var o=n(995),a=n(669),r=n(369),i=function(){function e(e){var t=this;this.data=[];var n=document.createElement(\"div\");n.style.width=\"100%\",n.style.height=\"100%\",n.style.display=\"flex\",n.style.flexDirection=\"column\",n.style.alignItems=\"center\",n.style.justifyContent=\"center\",this.logDiv=(0,o.createLogDiv)(),this.button=(0,o.createButton)(function(){return(0,r.sendRequest)(t.data,t.logDiv)}),n.appendChild(this.button),n.appendChild(this.logDiv),e.element.appendChild(n)}return e.prototype.update=function(e){var t,n=null===(t=e.dataViews)||void 0===t?void 0:t[0];(0,o.log)(this.logDiv,\"DataView recebido? \".concat(n?\"Sim\":\"Não\")),(null==n?void 0:n.table)?(0,o.log)(this.logDiv,\"Tipo detectado: TABLE\"):(null==n?void 0:n.categorical)?(0,o.log)(this.logDiv,\"Tipo detectado: CATEGORICAL\"):(null==n?void 0:n.matrix)?(0,o.log)(this.logDiv,\"Tipo detectado: MATRIX\"):(0,o.log)(this.logDiv,\"Tipo de DataView desconhecido ou vazio\"),this.data=(0,a.extractTableData)(n),(0,o.log)(this.logDiv,\"Dados carregados: \".concat(this.data.length,\" linha(s).\")),this.button.disabled=0===this.data.length},e}();t.Visual=i},995:(e,t)=>{Object.defineProperty(t,\"__esModule\",{value:!0}),t.log=t.createLogDiv=t.createButton=void 0,t.createButton=function(e){var t=document.createElement(\"button\");return t.textContent=\"Gerar Relatório\",t.disabled=!0,t.style.margin=\"10px 0\",t.style.padding=\"6px 14px\",t.style.fontSize=\"14px\",t.onclick=e,t},t.createLogDiv=function(){var e=document.createElement(\"div\");return e.style.width=\"90%\",e.style.height=\"150px\",e.style.overflowY=\"auto\",e.style.border=\"1px solid #ccc\",e.style.padding=\"8px\",e.style.fontSize=\"12px\",e.style.fontFamily=\"monospace\",e.style.backgroundColor=\"#f9f9f9\",e.style.whiteSpace=\"pre-wrap\",e.style.marginTop=\"10px\",e},t.log=function(e,t){var n=(new Date).toLocaleTimeString();e.textContent+=\"[\".concat(n,\"] \").concat(t,\"\\n\"),e.scrollTop=e.scrollHeight}}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}var o={};(()=>{var e=o;Object.defineProperty(e,\"__esModule\",{value:!0});var t=n(764),a=window.powerbi,r={name:\"qe5k6fz8g7ydw\",displayName:\"Gerar Relatório\",class:\"Visual\",apiVersion:\"5.3.0\",create:function(e){if(t.Visual)return new t.Visual(e);throw\"Visual instance not found\"},createModalDialog:function(e,t,n){var o=globalThis.dialogRegistry;e in o&&new o[e](t,n)},custom:!0};void 0!==a&&(a.visuals=a.visuals||{},a.visuals.plugins=a.visuals.plugins||{},a.visuals.plugins.qe5k6fz8g7ydw=r),e.default=r})(),qe5k6fz8g7ydw=o})();","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACcklEQVR4nGNgGAWjYBSMgmEJDOsNpfRqDX11aw0bdGsNN+vWGj5jGIzAvt6eRb9GX1uvxiBOt8Zwol6t0W69WsM3erVG/9HxQLuVQb3Uilev2thGt9YoDeRY3RrDI3o1ht+xOXbAPaBboSsIdmyNUb5ujdEi3Rqjq3o1Rn+JdeyAe0CPAofiwj7rA8jC3uv9jwxpD/isDyA99kY9UDsaA/8HXRJCBjCH4QOjHtBDCr3Obd0ooVO+qgpF3q7d6f+XH1/g8j07+gZXDBjWm/6/9eI23PC7r+7+N6gzgcsvPb4cLnfn5Z3/Rg1mg68YTZmfjhJCuUsKwOIevT7/f/7+CRb79+/f/+R5aYO3Hth7bT/cA5ceXwaLbbmwFS62+cKWwZ2Jvfp8//+AhjYIlKws///3318w+9P3T/8dO10Gtwf0ao3+zzowB27Jx28f4ez2LZ1Doxg1b7b+//LjSxTLrj+78d+gHpGpB20e0Ks1+m/VaofhgWfvn/03a7IaGh5YfXot3OGvP7+Bs2funz34k1Di3BRwUQkC3399/5+3tBBuIago9Z0QOHg9YNJo8f/uq3twC+YcnAcWP3r7GFzs2J0Tg9cDMw/MRil9bNscwOKhUyPgRSkIlK6sGHx5IGhy6P9ff37hbOvsvLwLJV+AMvqg8YBBncn/8w8vwB0IKoFMmyxRHTch4P+fv3/gahYfWzr4kpAehXjUAwMdA4OmItMb9UDAaAwMqSTkvd7/MMOIG9zFNbyuW2tkDJsLGNTD6+RMcOjVGnWAZmMG7QQHCYBRq95QRbfOOFS31rBNr8Zom16N4XNSDBgFo2AUjAKGIQEAkqNB3aFhJ4wAAAAASUVORK5CYII="},"visualEntryPoint":""}